"use strict";(self.webpackChunkopenbrush=self.webpackChunkopenbrush||[]).push([[3815],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),c=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=c(e.components);return i.createElement(l.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),h=o,d=p["".concat(l,".").concat(h)]||p[h]||m[h]||a;return n?i.createElement(d,r(r({ref:t},u),{},{components:n})):i.createElement(d,r({ref:t},u))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:o,r[1]=s;for(var c=2;c<a;c++)r[c]=n[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}h.displayName="MDXCreateElement"},3159:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var i=n(7462),o=(n(7294),n(3905));const a={sidebar_position:5,slug:"/obce",title:"OBCE",sidebar_label:"OBCE"},r="OpenBrush Chain Extension library",s={unversionedId:"obce",id:"obce",title:"OBCE",description:"Chain extensions are a way to extend the functionality available to smart contracts on a given node. It allows your smart contracts to directly use the features of the chain it was deployed on.",source:"@site/docs/obce.md",sourceDirName:".",slug:"/obce",permalink:"/docs/obce",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,slug:"/obce",title:"OBCE",sidebar_label:"OBCE"},sidebar:"tutorialSidebar",previous:{title:"Typechain-compiler package",permalink:"/docs/Typechain/typechain-compiler"},next:{title:"cargo-contract",permalink:"/docs/cargo-contract"}},l={},c=[{value:"Chain extension definition",id:"chain-extension-definition",level:2},{value:"Chain extension implementation",id:"chain-extension-implementation",level:2}],u={toc:c},p="wrapper";function m(e){let{components:t,...n}=e;return(0,o.kt)(p,(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"openbrush-chain-extension-library"},"OpenBrush Chain Extension library"),(0,o.kt)("p",null,"Chain extensions are a way to extend the functionality available to smart contracts on a given node. It allows your smart contracts to directly use the features of the chain it was deployed on."),(0,o.kt)("p",null,"When manually implementing chain extensions, you have to provide both ink! and Substrate parts of your new functionality."),(0,o.kt)("p",null,"For ink!, you have to provide a custom glue code using ",(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/ink_env/4.0.0/ink_env/chain_extension/struct.ChainExtensionMethod.html"},(0,o.kt)("inlineCode",{parentName:"a"},"ChainExtensionMethod"))," struct.\nThis glue code will call its Substrate counterpart if implemented correctly."),(0,o.kt)("p",null,"For Substrate, the implementation is more complex, as you have to implement ",(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/pallet-contracts/latest/pallet_contracts/chain_extension/trait.ChainExtension.html"},(0,o.kt)("inlineCode",{parentName:"a"},"ChainExtension"))," trait all by yourself, with manual method identifier matching, input/output decoding/encoding, etc."),(0,o.kt)("p",null,"You must not forget to correctly match ink!'s glue code with Substrate implementation, otherwise you're into some hard to debug error zone!"),(0,o.kt)("p",null,"And this is where OBCE comes in handy, since with OBCE such problems simply don't exist. All that's left to do in order to use chain extensions in your contract is to use the automatically generated code!"),(0,o.kt)("p",null,"OBCE (OpenBrush Chain Extension) is a library designed to help\nyou create your own custom chain extensions, with bindings for both ink!\nand Substrate."),(0,o.kt)("p",null,"OBCE takes care of identifier matching, necessary trait implementations and\nerror generations. All that's left to you is to take care of the Substrate implementation itself."),(0,o.kt)("h2",{id:"chain-extension-definition"},"Chain extension definition"),(0,o.kt)("p",null,"With ",(0,o.kt)("inlineCode",{parentName:"p"},"#[obce::definition]")," macro, you are able to generate your custom chain extension\ndefinition by just declaring a trait:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"#[obce::definition]\ntrait MyChainExtension {\n    fn custom_method(&self, val: u32) -> u64;\n}\n")),(0,o.kt)("p",null,"OBCE will automatically generate ink! bindings for smart contracts just from that definitions,\nproviding you with correct ",(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/pallet-contracts/latest/pallet_contracts/chain_extension/trait.RegisteredChainExtension.html"},"extension registration"),"\nand method identifier matching."),(0,o.kt)("p",null,"All that's left is to implement the trait itself on a public struct for users to use:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},'#[cfg(feature = "ink")]\nmod ink {\n    #[derive(Default)]\n    pub struct Extension;\n    \n    impl crate::MyChainExtension for Extension {}\n}\n')),(0,o.kt)("p",null,"For Substrate, this definition can later be used to implement the chain extension itself."),(0,o.kt)("h2",{id:"chain-extension-implementation"},"Chain extension implementation"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"#[obce::implementation]")," macro provides capabilities to implement the chain extension itself:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"#[cfg(feature = \"substrate\")]\nmod substrate {\n    use obce::substrate::{\n        frame_system::Config as SysConfig,\n        pallet_contracts::{\n            chain_extension::Ext,\n            Config as ContractConfig\n        },\n        sp_runtime::traits::StaticLookup,\n        ExtensionContext,\n    };\n    \n    #[derive(Default)]\n    pub struct Extension;\n\n    #[obce::implementation]\n    impl<'a, 'b, E, T> MyChainExtension for ExtensionContext<'a, 'b, E, T, Extension>\n    where\n        T: SysConfig + ContractConfig,\n        <<T as SysConfig>::Lookup as StaticLookup>::Source: From<<T as SysConfig>::AccountId>,\n        E: Ext<T = T>,\n    {\n        fn custom_method(&self, val: u32) -> u64 {\n            todo!()\n        }\n    }\n}\n")),(0,o.kt)("p",null,"Now, all that's left for you is to simply activate the chain extension in your runtime configuration like so:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"impl pallet_contracts::Config for Runtime {\n    // ...\n\n    type ChainExtension = (\n        pallet_assets_chain_extension::substrate::AssetsExtension,\n\n        // Your custom extension\n        my_chain_extension::substrate::Extension,\n    );\n\n    // ...\n}\n")))}m.isMDXComponent=!0}}]);